Использование протокола MODBUS TCP
==================================

Протокол Modbus — самый распространенный промышленный протокол для M2M-взаимодействия. Является стандартом де-факто и поддерживается почти всеми
производителями промышленного оборудования.

Обзор протокола
---------------

Физический уровень
~~~~~~~~~~~~~~~~~~

Протокол MODBUS TCP работает на физическом уровне с использованием стека протоколов TCP/IP. Это означает, что он использует стандартный ``Ethernet-кабель`` для подключения к сети и использует протокол ``TCP/IP`` для передачи данных.

MODBUS TCP работает по принципу ``клиент-серверной архитектуры``, где клиентское устройство (например, компьютер или контроллер) и серверное устройство (например, датчик или привод) общаются друг с другом посредством определенных сообщений, отправляемых через сеть.

Логический уровень
~~~~~~~~~~~~~~~~~~

Протокол MODBUS TCP работает на логическом уровне с использованием клиент-серверной модели передачи данных. Это означает, что клиентское устройство (например, компьютер или контроллер) отправляет запрос на серверное устройство (например, датчик или привод), который затем обрабатывает запрос и отправляет ответ обратно клиенту.

На логическом уровне, протокол MODBUS TCP использует различные функции для чтения и записи данных. Каждая функция имеет свой уникальный код, который определяет тип операции, которую необходимо выполнить. Например, функция ``чтения регистров`` имеет код 03, а функция ``записи регистров`` имеет код 06.

.. figure:: images/2.jpg
       :width: 40%
       :align: center
       :alt: Логический уровень


Формат пакета
~~~~~~~~~~~~~
Все устройства Modbus взаимодействуют, следуя модели ``master-slave``. Запросы может инициировать только master-устройство, ``slave-устройства`` могут только отвечать на запросы, и не могут самостоятельно начинать передачу данных. В зависимости от реализации протокола, заголовки пакета различаются. Вот основные составляющие пакета, которые важно знать::

    ADU (Application Data Unit) — пакет Modbus целиком, со всеми заголовками, PDU, контрольной суммой, адресом и маркерами. Отличается, в зависимости от реализации протокола.
    PDU (protocol data unit) — основная часть пакета, одинаковая для всех реализаций протокола. Содержит сам payload.

